<root>
	<styles>
			<include src="s2r://panorama/styles/dotastyles.vcss_c" />
			<include src="file://{resources}/styles/custom_game/multiteam_hero_select_overlay.css" />
	</styles>
	<script>
		var isPatreon;
		var isSameHeroDay = false;

		function GoToPatreonPage() {
			if (isPatreon || isSameHeroDay) return;
			$.DispatchEvent('ExternalBrowserGoToURL', 'https://www.patreon.com/dota2unofficial')
		}
		function TogglePatreonBonusButton() {
			if (!isPatreon && !isSameHeroDay) return;
			var enable = $('#PatreonBonusButton').checked;
			GameEvents.SendCustomGameEventToServer("set_patreon_bonus", { enable: enable } );
		}
		function OnMouseOver() {
			if (isPatreon || isSameHeroDay) return;
			$.DispatchEvent('DOTAShowTextTooltip', '#patreon_bonus_button_tooltip')
		}

		(function() {
			var patreonBonuses = CustomNetTables.GetTableValue("game_state", "patreon_bonus");
			$('#PatreonBonusButton').checked = !patreonBonuses || patreonBonuses[Game.GetLocalPlayerID()] !== 0;

			isSameHeroDay = Boolean((CustomNetTables.GetTableValue('game_state', 'is_same_hero_day') || {}).enable);
			$('#PatreonBonusButton').SetHasClass("IsSameHeroDay", isSameHeroDay)
			var patreons = CustomNetTables.GetTableValue('game_state', 'patreons') || {};
			isPatreon = Boolean(patreons[Game.GetLocalPlayerID()]);
			if (!isPatreon && !isSameHeroDay) $('#PatreonBonusButton').checked = false;
			$('#PatreonBonusButton').enabled = isPatreon || isSameHeroDay
			CustomNetTables.SubscribeNetTableListener('game_state', function(_tableName, key, value) {
				if (key === 'patreons') isPatreon = Boolean(value[Game.GetLocalPlayerID()]);
				if (key === 'is_same_hero_day') {
					isSameHeroDay = Boolean(value.enable);
					$('#PatreonBonusButton').SetHasClass("IsSameHeroDay", isSameHeroDay)
				}
				if (key === 'patreons' || key === 'is_same_hero_day') {
					if (!isPatreon && !isSameHeroDay) $('#PatreonBonusButton').checked = false;
					$('#PatreonBonusButton').enabled = isPatreon || isSameHeroDay
				}
			});
		})();
	</script>
	<Panel
		class="PatreonBonusButtonContainer"
		onmouseactivate="GoToPatreonPage()"
		onmouseover="OnMouseOver()"
		onmouseout="DOTAHideTextTooltip()"
	>
		<ToggleButton text="#patreon_bonus_button_text" id="PatreonBonusButton" onactivate="TogglePatreonBonusButton()" />
	</Panel>
</root>
