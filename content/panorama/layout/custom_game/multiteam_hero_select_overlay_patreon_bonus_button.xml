<root>
	<styles>
		<include src="s2r://panorama/styles/dotastyles.vcss_c" />
		<include src="file://{resources}/styles/custom_game/multiteam_hero_select_overlay.css" />
	</styles>
	<scripts>
		<include src="file://{resources}/scripts/custom_game/util.js" />
	</scripts>
	<script>
		var isPatreon = false;

		function GoToPatreonPage() {
			if (isPatreon) return;
			$.DispatchEvent('ExternalBrowserGoToURL', 'https://www.patreon.com/dota2unofficial')
		}

		function TogglePatreonBonusButton() {
			if (!isPatreon) return;
			var enabled = $('#PatreonBonusButton').checked;
			GameEvents.SendCustomGameEventToServer("patreon_toggle_boots", { enabled: enabled } );
		}

		function OnMouseOver() {
			if (isPatreon) return;
			$.DispatchEvent('DOTAShowTextTooltip', '#patreon_bonus_button_tooltip')
		}

		var firstUpdate = true;
		SubscribeToNetTableKey('game_state', 'patreon_bonuses', function(value) {
			var playerBonuses = value[Game.GetLocalPlayerID()];
			if (!playerBonuses) return;
			if (!firstUpdate) return;
			firstUpdate = false;

			isPatreon = playerBonuses.level > 0;
			$('#PatreonBonusButton').enabled = isPatreon;
			$('#PatreonBonusButton').checked = isPatreon && playerBonuses.bootsEnabled;
		});
	</script>
	<Panel
		class="PatreonBonusButtonContainer"
		onmouseactivate="GoToPatreonPage()"
		onmouseover="OnMouseOver()"
		onmouseout="DOTAHideTextTooltip()"
	>
		<ToggleButton text="#patreon_bonus_button_text" id="PatreonBonusButton" onactivate="TogglePatreonBonusButton()" />
	</Panel>
</root>
